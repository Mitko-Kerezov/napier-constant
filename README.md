<h1 align="center">
<br><br><br><br><br><br>
  <b>Проект</b><br>
  по Разпределени Софтуерни Архитектури
  <br><br>
  <b>Пресмятане на Неперовото число</b>
  <br><br>
  Изготвил:<br>
  Димитър Керезов<br>
  <br><br>
  Ръководител:<br>
  ас. Христо Христов<br>

</h1>
<br><br><br><br><br><br><br><br><br><br>
<p align="right">
    Проверил:......<br>
    (ас. Христо Христов)
</p>
<br><br><br><br><br><br><br><br>

## Условие
Да се пресметне Неперовото число със зададена точност, като се използва следният сходящ ред:

![Формула](https://raw.githubusercontent.com/Mitko-Kerezov/napier-constant/master/formula.png)

## Програмата

Програмата е реализирана чрез програмният език Python версия 2.6.6. Програмата може да се стартира посредством python изпълнимият файл:
```Shell
$ python napier.py -t 2 -p 1000
```

Параметрите, които програмата приема са:
* -h, --help - изкарва помощна информация за програмата
* -p P, --precision P - задава точност на изчисленията
* -t T, --tasks T - задава брой нишки за изпълнение
* -o File - указва име на файл, в който да бъде записано времето за изпълнение на програмата
* -q, --quiet - указва "тих" режим на програмата, при него нищо не се напечатва на стандартния изход

За генериране на тестови резултати, бе използвана BASH командата

```BASH
$ for ((precision=1000; precision<3001; precision+=1000)) {
    for ((count=1; count<=10; ++count)) {
        for ((threads=1; threads<=24; ++threads)) {
            python napier.py -t $threads -p $precision -o results/$precision/$threads.txt -q;
        };
    };
}
```

Чрез тази команда се пуска програмата да смята с точност съответно 1000, 2000 и 3000 по 10 пъти с от 1 до 24 нишки включително. Всички тези резултати бяха усреднени, за да се избегнат евентуални флуктуации при графичното изобразяване и изследване.

## Алгоритъм
Алгоритъмът за решаване разделя работата на нишките по равно, като използва деление по модул. Така например ако имаме да смятаме с точност 6 и две нишки, то първата нишка ще намери 0, 2 и 4-ти член, докато втората - 1, 3 и 5-ти член. Целта на този тип разделяне е максимално оползотворяване на работата на всички нишки.

## Проблеми, срещнати по време на разработка
Първоначалната имплементация на проекта бе писана на `NodeJS`, използвайки **cluster** модула. Разпалеляването се получаваше добре, но имах проблеми с пресмятането с голяма точност, поради естеството на езика **JavaScript**. Втората имплементация на проекта бе на `Python`, реализирана посредством **Thread** класът от модула `threading`. Поради естеството на езика `Python`, тази имплементация забавяше работата, вместо да я забърза. Това се дължи на `Global Interpreter Lock`, който е mutex в `Python`, забраняващ няколко нишки да изпълняват `Python` биткод едновременно. Третата имплементация на проекта бе на `C`, но при нея също имах проблем с прецизните сметки. Накрая се върнах към `Python` имплементацията, но вместо **Thread** класът, използвах `Process` класът от модула `multiprocessing`. Чрез стартирането на винаги нови процеси успях да избегна `Global Interpreter Lock` рестрикцията на езика. Кодът бе писан на `Windows 10` и тестван на `Python 3.5.1`. На `Linux` машината с хост `ats24.rmi.yaht.net` има инсталиран `Python 2.6.6`, което наложи известна промяна в кода, заради разликите между версия 2 и версия 3 на езика.

## Ускорение, ефективност и бързодействие
Тестовете бяха проведени на:
* 64-битов `Windows 10`, `Python 2.7.11`, процесор - 4-ядрен `Intel Core i7-4720HQ`
* 64-битов `Linux` с дистрибуция `CentOS` и `Python 2.6.6`, процесор - 12-ядрен `Intel Xeon X5650`

### Време за изпълнение и брой нишки
![Време за изпълнение](https://raw.githubusercontent.com/Mitko-Kerezov/napier-constant/master/results/plots/execution-time.png)

### Ускорение
![Ускорение](https://raw.githubusercontent.com/Mitko-Kerezov/napier-constant/master/results/plots/acceleration.png)

### Ефективност
![Ефективност](https://raw.githubusercontent.com/Mitko-Kerezov/napier-constant/master/results/plots/efficiency.png)

### Табличен вид
#### Точност 1000
<table>
  <tr>
    <td></td>
    <td colspan="3" align="center">Windows</td>
    <td colspan="3" align="center">Linux</td>
  </tr>
  <tr>
    <td>Брой нишки</td>
    <td>Време за изпълнение</td>
    <td>Ускорение</td>
    <td>Ефективност</td>
    <td>Време за изпълнение</td>
    <td>Ускорение</td>
    <td>Ефективност</td>
  </tr>
  <tr> <td> 1 </td> <td> 2,683859985 </td> <td> 1 </td> <td> 1 </td> <td> 10,20986392 </td> <td> 1 </td> <td> 1 </td> </tr>
<tr> <td> 2 </td> <td> 1,357008211 </td> <td> 1,977777262 </td> <td> 0,988888631 </td> <td> 5,158134389 </td> <td> 1,979371446 </td> <td> 0,989685723 </td> </tr>
<tr> <td> 3 </td> <td> 0,941814467 </td> <td> 2,849669525 </td> <td> 0,949889842 </td> <td> 3,522635627 </td> <td> 2,898359356 </td> <td> 0,966119785 </td> </tr>
<tr> <td> 4 </td> <td> 0,798606115 </td> <td> 3,360680485 </td> <td> 0,840170121 </td> <td> 2,610840511 </td> <td> 3,91056592 </td> <td> 0,97764148 </td> </tr>
<tr> <td> 5 </td> <td> 0,731560469 </td> <td> 3,668678257 </td> <td> 0,733735651 </td> <td> 2,136924505 </td> <td> 4,777830897 </td> <td> 0,955566179 </td> </tr>
<tr> <td> 6 </td> <td> 0,662679007 </td> <td> 4,050015098 </td> <td> 0,675002516 </td> <td> 1,743468237 </td> <td> 5,856065347 </td> <td> 0,976010891 </td> </tr>
<tr> <td> 7 </td> <td> 0,60603788 </td> <td> 4,428535035 </td> <td> 0,632647862 </td> <td> 1,501834607 </td> <td> 6,798261191 </td> <td> 0,97118017 </td> </tr>
<tr> <td> 8 </td> <td> 0,572678072 </td> <td> 4,686507337 </td> <td> 0,585813417 </td> <td> 1,328862429 </td> <td> 7,683160954 </td> <td> 0,960395119 </td> </tr>
<tr> <td> 9 </td> <td> 0,625362278 </td> <td> 4,291688321 </td> <td> 0,476854258 </td> <td> 1,214317703 </td> <td> 8,407901736 </td> <td> 0,934211304 </td> </tr>
<tr> <td> 10 </td> <td> 0,648846699 </td> <td> 4,136354533 </td> <td> 0,413635453 </td> <td> 1,087885523 </td> <td> 9,385053584 </td> <td> 0,938505358 </td> </tr>
<tr> <td> 11 </td> <td> 0,661737908 </td> <td> 4,055774882 </td> <td> 0,368706807 </td> <td> 1,043447518 </td> <td> 9,784741202 </td> <td> 0,889521927 </td> </tr>
<tr> <td> 12 </td> <td> 0,680107153 </td> <td> 3,946231081 </td> <td> 0,32885259 </td> <td> 0,982720828 </td> <td> 10,38938388 </td> <td> 0,86578199 </td> </tr>
<tr> <td> 13 </td> <td> 0,70609358 </td> <td> 3,800997573 </td> <td> 0,292384429 </td> <td> 0,9472018 </td> <td> 10,77897437 </td> <td> 0,829151874 </td> </tr>
<tr> <td> 14 </td> <td> 0,729258643 </td> <td> 3,680258039 </td> <td> 0,262875574 </td> <td> 0,929622388 </td> <td> 10,98280771 </td> <td> 0,784486265 </td> </tr>
<tr> <td> 15 </td> <td> 0,722697948 </td> <td> 3,713667644 </td> <td> 0,247577843 </td> <td> 0,861896086 </td> <td> 11,84581772 </td> <td> 0,789721181 </td> </tr>
<tr> <td> 16 </td> <td> 0,729356464 </td> <td> 3,679764446 </td> <td> 0,229985278 </td> <td> 0,867734551 </td> <td> 11,76611431 </td> <td> 0,735382145 </td> </tr>
<tr> <td> 17 </td> <td> 0,745980017 </td> <td> 3,597763914 </td> <td> 0,211633171 </td> <td> 0,820655298 </td> <td> 12,44111133 </td> <td> 0,731830078 </td> </tr>
<tr> <td> 18 </td> <td> 0,768831801 </td> <td> 3,490828529 </td> <td> 0,193934918 </td> <td> 0,844107389 </td> <td> 12,09545616 </td> <td> 0,671969787 </td> </tr>
<tr> <td> 19 </td> <td> 0,769083892 </td> <td> 3,4896843 </td> <td> 0,183667595 </td> <td> 0,857596397 </td> <td> 11,90520851 </td> <td> 0,626589921 </td> </tr>
<tr> <td> 20 </td> <td> 0,78732496 </td> <td> 3,408833863 </td> <td> 0,170441693 </td> <td> 0,851911497 </td> <td> 11,98465329 </td> <td> 0,599232664 </td> </tr>
<tr> <td> 21 </td> <td> 0,787590434 </td> <td> 3,407684844 </td> <td> 0,162270707 </td> <td> 0,858309388 </td> <td> 11,89531894 </td> <td> 0,566443759 </td> </tr>
<tr> <td> 22 </td> <td> 0,808871324 </td> <td> 3,318030823 </td> <td> 0,150819583 </td> <td> 0,833620048 </td> <td> 12,24762283 </td> <td> 0,556710129 </td> </tr>
<tr> <td> 23 </td> <td> 0,821198623 </td> <td> 3,268222705 </td> <td> 0,142096639 </td> <td> 0,784019256 </td> <td> 13,02246578 </td> <td> 0,566194164 </td> </tr>
<tr> <td> 24 </td> <td> 0,831353221 </td> <td> 3,228302863 </td> <td> 0,134512619 </td> <td> 0,791152406 </td> <td> 12,90505325 </td> <td> 0,537710552 </td> </tr>

</table>

#### Точност 2000
<table>
  <tr>
    <td></td>
    <td colspan="3" align="center">Windows</td>
    <td colspan="3" align="center">Linux</td>
  </tr>
  <tr>
    <td>Брой нишки</td>
    <td>Време за изпълнение</td>
    <td>Ускорение</td>
    <td>Ефективност</td>
    <td>Време за изпълнение</td>
    <td>Ускорение</td>
    <td>Ефективност</td>
  </tr>
<tr> <td> 1 </td> <td> 21,15951907 </td> <td> 1 </td> <td> 1 </td> <td> 76,89471237 </td> <td> 1 </td> <td> 1 </td> </tr>
<tr> <td> 2 </td> <td> 10,60139223 </td> <td> 1,995918896 </td> <td> 0,997959448 </td> <td> 39,12026181 </td> <td> 1,965598102 </td> <td> 0,982799051 </td> </tr>
<tr> <td> 3 </td> <td> 7,293147935 </td> <td> 2,901287518 </td> <td> 0,967095839 </td> <td> 25,6744042 </td> <td> 2,994995006 </td> <td> 0,998331669 </td> </tr>
<tr> <td> 4 </td> <td> 5,823430892 </td> <td> 3,63351424 </td> <td> 0,90837856 </td> <td> 19,63274045 </td> <td> 3,916657105 </td> <td> 0,979164276 </td> </tr>
<tr> <td> 5 </td> <td> 5,181006408 </td> <td> 4,084055761 </td> <td> 0,816811152 </td> <td> 15,6954416 </td> <td> 4,899174825 </td> <td> 0,979834965 </td> </tr>
<tr> <td> 6 </td> <td> 4,64151382 </td> <td> 4,558753865 </td> <td> 0,759792311 </td> <td> 13,07469847 </td> <td> 5,881184376 </td> <td> 0,980197396 </td> </tr>
<tr> <td> 7 </td> <td> 4,178293839 </td> <td> 5,06415295 </td> <td> 0,723450421 </td> <td> 10,99103208 </td> <td> 6,996132105 </td> <td> 0,999447444 </td> </tr>
<tr> <td> 8 </td> <td> 3,849419057 </td> <td> 5,496808417 </td> <td> 0,687101052 </td> <td> 9,61788187 </td> <td> 7,994973676 </td> <td> 0,999371709 </td> </tr>
<tr> <td> 9 </td> <td> 4,016758796 </td> <td> 5,267809232 </td> <td> 0,585312137 </td> <td> 8,672545004 </td> <td> 8,866452966 </td> <td> 0,985161441 </td> </tr>
<tr> <td> 10 </td> <td> 3,998559889 </td> <td> 5,291784957 </td> <td> 0,529178496 </td> <td> 7,742576241 </td> <td> 9,931411712 </td> <td> 0,993141171 </td> </tr>
<tr> <td> 11 </td> <td> 3,965166052 </td> <td> 5,336351313 </td> <td> 0,485122847 </td> <td> 7,087578583 </td> <td> 10,84922184 </td> <td> 0,986292895 </td> </tr>
<tr> <td> 12 </td> <td> 3,955041297 </td> <td> 5,350012169 </td> <td> 0,445834347 </td> <td> 6,593055916 </td> <td> 11,66298502 </td> <td> 0,971915418 </td> </tr>
<tr> <td> 13 </td> <td> 4,009292332 </td> <td> 5,27761942 </td> <td> 0,405970725 </td> <td> 6,510077333 </td> <td> 11,81164346 </td> <td> 0,908587959 </td> </tr>
<tr> <td> 14 </td> <td> 3,996503207 </td> <td> 5,294508217 </td> <td> 0,378179158 </td> <td> 6,109256887 </td> <td> 12,58659012 </td> <td> 0,899042151 </td> </tr>
<tr> <td> 15 </td> <td> 4,016617829 </td> <td> 5,267994111 </td> <td> 0,351199607 </td> <td> 5,955945086 </td> <td> 12,91058115 </td> <td> 0,86070541 </td> </tr>
<tr> <td> 16 </td> <td> 4,037200592 </td> <td> 5,241136423 </td> <td> 0,327571026 </td> <td> 5,61155591 </td> <td> 13,7029219 </td> <td> 0,856432619 </td> </tr>
<tr> <td> 17 </td> <td> 4,114826621 </td> <td> 5,142262608 </td> <td> 0,302486036 </td> <td> 5,440617085 </td> <td> 14,1334542 </td> <td> 0,831379659 </td> </tr>
<tr> <td> 18 </td> <td> 4,116345289 </td> <td> 5,140365442 </td> <td> 0,285575858 </td> <td> 5,265198898 </td> <td> 14,60433193 </td> <td> 0,811351774 </td> </tr>
<tr> <td> 19 </td> <td> 4,158339567 </td> <td> 5,088453871 </td> <td> 0,267813362 </td> <td> 5,11263392 </td> <td> 15,04013657 </td> <td> 0,791586135 </td> </tr>
<tr> <td> 20 </td> <td> 4,149919529 </td> <td> 5,098778162 </td> <td> 0,254938908 </td> <td> 4,995305872 </td> <td> 15,39339419 </td> <td> 0,769669709 </td> </tr>
<tr> <td> 21 </td> <td> 4,272876318 </td> <td> 4,952055125 </td> <td> 0,235812149 </td> <td> 4,911590338 </td> <td> 15,65576668 </td> <td> 0,745512699 </td> </tr>
<tr> <td> 22 </td> <td> 4,26051282 </td> <td> 4,966425396 </td> <td> 0,225746609 </td> <td> 4,805696487 </td> <td> 16,00074257 </td> <td> 0,72730648 </td> </tr>
<tr> <td> 23 </td> <td> 4,23011862 </td> <td> 5,002110099 </td> <td> 0,217483048 </td> <td> 4,694656754 </td> <td> 16,37919797 </td> <td> 0,712139042 </td> </tr>
<tr> <td> 24 </td> <td> 4,350143316 </td> <td> 4,864097003 </td> <td> 0,202670708 </td> <td> 4,708056831 </td> <td> 16,33257947 </td> <td> 0,680524145 </td> </tr>

</table>

#### Точност 3000
<table>
  <tr>
    <td></td>
    <td colspan="3" align="center">Windows</td>
    <td colspan="3" align="center">Linux</td>
  </tr>
  <tr>
    <td>Брой нишки</td>
    <td>Време за изпълнение</td>
    <td>Ускорение</td>
    <td>Ефективност</td>
    <td>Време за изпълнение</td>
    <td>Ускорение</td>
    <td>Ефективност</td>
  </tr>
<tr> <td> 1 </td> <td> 74,60846263 </td> <td> 1 </td> <td> 1 </td> <td> 278,5421128 </td> <td> 1 </td> <td> 1 </td> </tr>
<tr> <td> 2 </td> <td> 37,39914512 </td> <td> 1,99492428 </td> <td> 0,99746214 </td> <td> 145,7759668 </td> <td> 1,910754694 </td> <td> 0,955377347 </td> </tr>
<tr> <td> 3 </td> <td> 25,61682468 </td> <td> 2,912478949 </td> <td> 0,970826316 </td> <td> 94,19443531 </td> <td> 2,957097326 </td> <td> 0,985699109 </td> </tr>
<tr> <td> 4 </td> <td> 25,61682468 </td> <td> 2,912478949 </td> <td> 0,728119737 </td> <td> 71,57588887 </td> <td> 3,891563447 </td> <td> 0,972890862 </td> </tr>
<tr> <td> 5 </td> <td> 18,19238495 </td> <td> 4,10108201 </td> <td> 0,820216402 </td> <td> 56,43292465 </td> <td> 4,935808564 </td> <td> 0,987161713 </td> </tr>
<tr> <td> 6 </td> <td> 15,99103559 </td> <td> 4,66564296 </td> <td> 0,77760716 </td> <td> 47,63736835 </td> <td> 5,84713477 </td> <td> 0,974522462 </td> </tr>
<tr> <td> 7 </td> <td> 14,42672217 </td> <td> 5,171546366 </td> <td> 0,738792338 </td> <td> 39,94232082 </td> <td> 6,97360862 </td> <td> 0,996229803 </td> </tr>
<tr> <td> 8 </td> <td> 13,46316535 </td> <td> 5,541673203 </td> <td> 0,69270915 </td> <td> 34,85967658 </td> <td> 7,990381443 </td> <td> 0,99879768 </td> </tr>
<tr> <td> 9 </td> <td> 13,81358495 </td> <td> 5,401093408 </td> <td> 0,60012149 </td> <td> 31,12676773 </td> <td> 8,948635953 </td> <td> 0,994292884 </td> </tr>
<tr> <td> 10 </td> <td> 13,68670989 </td> <td> 5,451161253 </td> <td> 0,545116125 </td> <td> 28,24060683 </td> <td> 9,86317732 </td> <td> 0,986317732 </td> </tr>
<tr> <td> 11 </td> <td> 13,52235017 </td> <td> 5,517418327 </td> <td> 0,501583484 </td> <td> 25,74315739 </td> <td> 10,82004467 </td> <td> 0,983640424 </td> </tr>
<tr> <td> 12 </td> <td> 13,3199881 </td> <td> 5,601240937 </td> <td> 0,466770078 </td> <td> 23,50244551 </td> <td> 11,85162254 </td> <td> 0,987635211 </td> </tr>
<tr> <td> 13 </td> <td> 13,35338166 </td> <td> 5,587233595 </td> <td> 0,4297872 </td> <td> 22,86205888 </td> <td> 12,18359704 </td> <td> 0,937199772 </td> </tr>
<tr> <td> 14 </td> <td> 13,35536113 </td> <td> 5,586405482 </td> <td> 0,399028963 </td> <td> 21,87916145 </td> <td> 12,73093182 </td> <td> 0,909352273 </td> </tr>
<tr> <td> 15 </td> <td> 13,36425341 </td> <td> 5,582688409 </td> <td> 0,372179227 </td> <td> 20,86662574 </td> <td> 13,34868974 </td> <td> 0,889912649 </td> </tr>
<tr> <td> 16 </td> <td> 13,41547161 </td> <td> 5,561374567 </td> <td> 0,34758591 </td> <td> 19,70901978 </td> <td> 14,13272278 </td> <td> 0,883295174 </td> </tr>
<tr> <td> 17 </td> <td> 13,40477036 </td> <td> 5,565814307 </td> <td> 0,327400842 </td> <td> 19,0635479 </td> <td> 14,61124206 </td> <td> 0,859484827 </td> </tr>
<tr> <td> 18 </td> <td> 13,43446217 </td> <td> 5,553513175 </td> <td> 0,30852851 </td> <td> 18,30883806 </td> <td> 15,21353304 </td> <td> 0,84519628 </td> </tr>
<tr> <td> 19 </td> <td> 13,43446217 </td> <td> 5,553513175 </td> <td> 0,292290167 </td> <td> 17,70076714 </td> <td> 15,73616051 </td> <td> 0,828218974 </td> </tr>
<tr> <td> 20 </td> <td> 13,44827987 </td> <td> 5,547807107 </td> <td> 0,277390355 </td> <td> 17,24768491 </td> <td> 16,14953626 </td> <td> 0,807476813 </td> </tr>
<tr> <td> 21 </td> <td> 13,58883735 </td> <td> 5,490422816 </td> <td> 0,261448706 </td> <td> 17,0478709 </td> <td> 16,3388211 </td> <td> 0,7780391 </td> </tr>
<tr> <td> 22 </td> <td> 13,57407827 </td> <td> 5,496392546 </td> <td> 0,249836025 </td> <td> 17,02031801 </td> <td> 16,36527077 </td> <td> 0,743875944 </td> </tr>
<tr> <td> 23 </td> <td> 13,75612806 </td> <td> 5,423652811 </td> <td> 0,235810992 </td> <td> 16,73799043 </td> <td> 16,64131151 </td> <td> 0,723535283 </td> </tr>
<tr> <td> 24 </td> <td> 13,72241155 </td> <td> 5,436978941 </td> <td> 0,226540789 </td> <td> 16,57860961 </td> <td> 16,80129512 </td> <td> 0,700053964 </td> </tr>

</table>
